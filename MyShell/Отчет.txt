
1) Синтаксис (BNF форма)
command    ::= pipeline (("&&" | "||") pipeline)* ("&" | ";")?
pipeline   ::= simple_command ("|" simple_command)*
simple_command ::= word+ (redirection word)*
redirection ::= "<" | ">" | ">>"
word       ::= последовательность символов без пробелов и операторов
           |   "строка в кавычках"
           |   переменная среды


2) Поддерживаемые конструкции
Простые команды: ls -la, echo hello

Пайпы: ls | grep txt | wc -l

Логические операторы:

&& - выполнить если предыдущая успешна

|| - выполнить если предыдущая неуспешна

Последовательности: ; - выполнить последовательно

Перенаправления:

< - ввод из файла

> - вывод в файл (перезапись)

>> - вывод в файл (добавление)

Фоновый режим: & в конце команды


3) Отличия от bash:

Переменные среды:

Поддерживаются только предопределенные: $HOME, $USER, $SHELL, $EUID

Также обрабатываются с префиксом S: $SHOME, $SUSER, $SSHELL, $SEUID

Нет поддержки произвольных переменных $VAR

Кавычки:

Поддерживаются только двойные кавычки "

Нет экранирования специальных символов внутри кавычек (кроме ")

Комментарии: # - комментарий до конца строки

Внутренние команды:

cd - смена директории

exit [код] - выход из shell

pwd - текущая директория

echo - вывод текста

5) Структура построения

Начало
│
Инициализация буфера и состояний
│
Цикл по символам строки:
│
├── Если escape-символ (\)
│   └── Следующий символ → в буфер
│
├── Если кавычка (")
│   └── Переключить флаг in_quote
│
├── Если комментарий (#) и не в кавычках
│   └── Завершить разбор
│
├── Если пробел и не в кавычках
│   └── Если буфер не пуст → создать токен
│
├── Если спецсимвол (| & ; < > ( )) и не в кавычках
│   └── Если буфер не пуст → создать токен
│       Если двойной оператор (&&, ||, >>) → создать токен из 2 символов
│       Иначе → создать токен из 1 символа
│
└── Иначе → символ в буфер
│
Если буфер не пуст → создать токен
│
Конец



Рекурсивный спуск с функциями:

build_tree()           ← точка входа
    │
    ▼
parse_cmd()           ← обрабатывает ; и & в конце
    │
    ▼  
parse_list()          ← обрабатывает && и ||
    │
    ▼
parse_pipe()          ← обрабатывает |
    │
    ▼
parse_cmd_base()      ← обрабатывает ( command ) или simple_command
    │
    ▼
parse_simple()        ← собирает команду и перенаправления